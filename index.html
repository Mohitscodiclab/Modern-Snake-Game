<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ultra-Modern Snake</title>
<style>
  :root{
    --bg:#0a0a0a;
    --panel:#0f0f0f;
    --muted:#9aa0a6;
    --accent:#e6e6e6;
    --glass: rgba(255,255,255,0.03);
    --ui-radius:12px;
    --cell-size:20px;
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{background:linear-gradient(180deg,#050505 0%,var(--bg) 100%);color:var(--accent);display:flex;align-items:center;justify-content:center;}
  .app{width:1100px;max-width:98vw;height:720px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);box-shadow:0 10px 40px rgba(0,0,0,0.8);border-radius:16px;display:grid;grid-template-columns:1fr 360px;overflow:hidden;}
  .left{padding:18px;display:flex;flex-direction:column;gap:12px}
  .hud{display:flex;justify-content:space-between;align-items:center;gap:10px}
  .title{font-weight:700;font-size:20px;letter-spacing:0.4px}
  .small{font-size:13px;color:var(--muted)}
  .board-wrap{background:var(--panel);border-radius:12px;padding:14px;display:flex;gap:14px;align-items:center;justify-content:center;flex:1}
 
  /* Canvas */
  #gameCanvas{background:linear-gradient(180deg, #060606, #0b0b0b);box-shadow:inset 0 0 40px rgba(0,0,0,0.6);border-radius:8px}
  /* Right panel */
  .right{padding:18px;display:flex;flex-direction:column;gap:12px;border-left:1px solid rgba(255,255,255,0.02)}
  .panel{background:var(--glass);padding:12px;border-radius:10px}
  .controls{display:flex;flex-direction:column;gap:10px}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  input[type="range"]{width:100%}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px 12px;border-radius:10px;color:var(--accent);cursor:pointer}
  .btn.primary{background:#1a1a1a;border:1px solid rgba(255,255,255,0.06);box-shadow:0 6px 14px rgba(0,0,0,0.6)}
  .preset-row{display:flex;gap:8px;flex-wrap:wrap}
  .preset{width:36px;height:36px;border-radius:8px;border:2px solid rgba(255,255,255,0.04);cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.6)}
  .menu{display:flex;flex-direction:column;gap:8px}
  .menu button{padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--accent);cursor:pointer}
  .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5)}
  /* modal */
  .modal{background:#060606;border-radius:12px;padding:18px;min-width:360px}
  .row{display:flex;gap:8px;align-items:center}
  .muted{color:var(--muted);font-size:13px}
  .countdown{font-size:56px;font-weight:800;color:#fff;text-shadow:0 6px 18px rgba(0,0,0,0.7)}
  .score{font-weight:700}
  footer.small{font-size:12px;color:var(--muted);text-align:center;margin-top:auto;padding:8px}
  @media (max-width:980px){.app{grid-template-columns:1fr 320px;height:78vh}}
  footer a {
  color: #00ffff;
  text-decoration: none;
  font-weight: 500;
  transition: color 0.3s, text-shadow 0.3s;
}

footer a:hover {
  color: #39ff14;
  text-shadow: 0 0 8px #39ff14;
}

</style>














<link rel="icon" type="image/png" href="asset/head.png">








</head>
<body>
<div class="app" id="appRoot" role="application" aria-label="Ultra Modern Snake Game">
  <div class="left">
    <div class="hud">
      <div>
        <div class="title">Ultra Modern Snake</div>
        <div class="small">Ultra-dark • Crisp blocks • Digestion animation</div>
      </div>
      <div class="row small">
        <div class="score">Score: <span id="uiScore">0</span></div>
        <div style="width:12px"></div>
        <div class="small">Mode: <span id="uiMode">Loop</span></div>
      </div>
    </div>

    <div class="board-wrap" id="boardWrap">
      <canvas id="gameCanvas" width="600" height="400" style="width:100%;height:100%;max-width:900px;max-height:600px;"></canvas>
    </div>

    <div style="display:flex;gap:12px;align-items:center">
      <button class="btn primary" id="btnNew">New Game</button>
      <button class="btn" id="btnHistory">History</button>
      <button class="btn" id="btnSettings">Settings</button>
      <div style="flex:1"></div>
      <div class="muted">Controls: Arrow / WASD • P = Pause • ESC = Back</div>
    </div>
  </div>

  <div class="right">
    <div class="panel">
      <div class="muted">Player</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="inpName" placeholder="Name" style="flex:1;padding:10px;border-radius:8px;background:#0b0b0b;border:1px solid rgba(255,255,255,0.03);color:var(--accent)"/>
        <input id="inpAge" placeholder="Age" type="number" min="1" style="width:80px;padding:10px;border-radius:8px;background:#0b0b0b;border:1px solid rgba(255,255,255,0.03);color:var(--accent)"/>
      </div>
    </div>

    <div class="panel">
      <div class="muted">Variant</div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <select id="selVariant" style="flex:1;padding:10px;border-radius:8px;background:#0b0b0b;border:1px solid rgba(255,255,255,0.03);color:var(--accent)">
          <option value="loop">Loop Mode</option>
          <option value="box">Box Mode</option>
        </select>
        <label style="display:flex;align-items:center;gap:6px"><input type="checkbox" id="chkKids"/> Kids</label>
      </div>
      <div class="muted" style="margin-top:8px">Countdown & Start</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn primary" id="btnStart">Start (Space)</button>
        <button class="btn" id="btnQuick">Quick Start</button>
      </div>
    </div>

    <div class="panel controls">
      <div class="muted">Snake Speed</div>
      <input type="range" id="speedRange" min="1" max="20" value="8"/>
      <div class="muted">Snake Color Presets (good contrast with dark bg)</div>
      <div class="preset-row" id="presetRow" style="margin-top:8px">
        <!-- Presets generated by JS -->
      </div>
    </div>

    <div class="panel">
      <div class="muted">Sound</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <label style="display:flex;align-items:center;gap:6px"><input type="checkbox" id="chkSound" checked/> Enable</label>
        <div style="flex:1"></div>
        <button class="btn" id="btnLoadSounds">Check Sounds</button>
      </div>
      <div class="muted" style="margin-top:10px">Notes: Place <code>eat.wav</code> and <code>game_over.wav</code> in same folder as this HTML. Missing sounds are ignored.</div>
    </div>

    <div style="flex:1"></div>
    <footer class="small">
  Ultra-Modern Snake • Built with ❤️ by 
  <a href="https://github.com/mohitscodiclab" target="_blank" rel="noopener noreferrer">
    Mohitcodiclab
  </a>
</footer>

  </div>

  <!-- Modal containers -->
  <div id="modalRoot" style="position:absolute;inset:0;display:none;align-items:center;justify-content:center;"></div>
</div>


































<script>
/* ===========================
   Ultra-Modern Snake JS
   All in one file for easy testing.
   =========================== */

(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d', { alpha: false });
  const UI = {
    score: document.getElementById('uiScore'),
    mode: document.getElementById('uiMode'),
    name: document.getElementById('inpName'),
    age: document.getElementById('inpAge'),
    variant: document.getElementById('selVariant'),
    speedRange: document.getElementById('speedRange'),
    presetRow: document.getElementById('presetRow'),
    presetColors: [
      [0,255,0],     // bright green
      [0,255,255],   // cyan
      [255,165,0],   // orange
      [255,0,255],   // magenta
      [180,255,120], // lime
      [0,200,180],   // teal
      [255,120,120], // coral (added)
      [180,180,255]  // soft blue
    ],
    chkKids: document.getElementById('chkKids'),
    chkSound: document.getElementById('chkSound'),
    btnNew: document.getElementById('btnNew'),
    btnHistory: document.getElementById('btnHistory'),
    btnSettings: document.getElementById('btnSettings'),
    btnStart: document.getElementById('btnStart'),
    btnQuick: document.getElementById('btnQuick'),
    btnLoadSounds: document.getElementById('btnLoadSounds')
  };

  // Canvas logical grid
  const CELL = 20;
  const GRID_W = Math.floor(canvas.width / CELL);
  const GRID_H = Math.floor(canvas.height / CELL);

  // Game state
  let state = {
    snake: [],
    dir: {x:1,y:0},
    nextDir: {x:1,y:0},
    apple: null,
    score: 0,
    fps: parseInt(UI.speedRange.value,10),
    running: false,
    paused: false,
    loopMode: true,
    digestQueue: [], // stores indices for digestion pulse
    countdown: null,
    roundCount: 0 // for kids mode
  };

  // Audio
  const SND = {
    eat: null,
    gameOver: null,
    loaded: false
  };

  function loadSounds() {
    let ok = true;
    try {
      SND.eat = new Audio('asset/eat.wav');
      SND.gameOver = new Audio('asset/game_over.wav');
      SND.loaded = true;
    } catch (e) {
      SND.loaded = false;
      ok = false;
    }
    return ok;
  }

  // Helper
  function rgbToCss(arr){return `rgb(${arr[0]},${arr[1]},${arr[2]})`}
  function pickRandomEmpty(exclude){
    const occupied = new Set(exclude.map(p=>p.x+','+p.y));
    const choices = [];
    for(let x=0;x<GRID_W;x++) for(let y=0;y<GRID_H;y++){
      if(!occupied.has(x+','+y)) choices.push({x,y});
    }
    return choices.length? choices[Math.floor(Math.random()*choices.length)] : null;
  }

  // Preset UI
  UI.presetColors.forEach(col=>{
    const el = document.createElement('div');
    el.className = 'preset';
    el.style.background = rgbToCss(col);
    el.title = `Preset ${rgbToCss(col)}`;
    el.addEventListener('click', ()=> {
      setSnakeColor(col);
    });
    UI.presetRow.appendChild(el);
  });

  // Snake color (default)
  let SNAKE_COLOR = UI.presetColors[0];

  function setSnakeColor(col){
    SNAKE_COLOR = col;
    // highlight selection (simple)
    Array.from(UI.presetRow.children).forEach((c,i)=>{
      c.style.outline = (rgbToCss(UI.presetColors[i])===rgbToCss(col))? '2px solid rgba(255,255,255,0.08)' : 'none';
    });
  }
  setSnakeColor(SNAKE_COLOR);

  // Profiles / history using localStorage
  const STORAGE_KEY = 'ultrasnake_profiles_v1';
  function loadProfiles(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw? JSON.parse(raw): {};
    }catch(e){ return {} }
  }
  function saveProfiles(profiles){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(profiles));
  }
  function addScoreToProfile(name, age, score){
    const profiles = loadProfiles();
    const id = `${name.trim().toLowerCase()}_${age}`;
    if(!profiles[id]) profiles[id] = {name,age:parseInt(age,10),scores:[]};
    profiles[id].scores.push({score, time: Date.now()});
    saveProfiles(profiles);
  }

  // Game initializers
  function resetGame(){
    state.snake = [
      {x:Math.floor(GRID_W/2), y:Math.floor(GRID_H/2)},
      {x:Math.floor(GRID_W/2)-1, y:Math.floor(GRID_H/2)},
      {x:Math.floor(GRID_W/2)-2, y:Math.floor(GRID_H/2)}
    ];
    state.dir = {x:1,y:0};
    state.nextDir = {x:1,y:0};
    state.apple = pickRandomEmpty(state.snake);
    state.score = 0;
    state.fps = parseInt(UI.speedRange.value,10) || 8;
    state.running = false;
    state.paused = false;
    state.digestQueue = [];
    UI.score.textContent = '0';
    state.roundCount = 0;
  }

  resetGame();

  // Controls handling
  window.addEventListener('keydown', (e) => {
    if(e.code === 'Space') {
      if(!state.running) startCountdownAndRun();
      e.preventDefault();
      return;
    }
    if(e.key === 'Escape'){
      closeModal();
      // if in-game, treat as back/pause? here: unpause and return to menu
      if(state.running){ pauseGame(); showMainMenu(); }
      return;
    }
    if(e.key === 'p' || e.key === 'P'){
      if(state.running) togglePause();
      return;
    }
    // Direction keys
    const map = {
      ArrowUp: {x:0,y:-1}, ArrowDown:{x:0,y:1}, ArrowLeft:{x:-1,y:0}, ArrowRight:{x:1,y:0},
      w:{x:0,y:-1}, s:{x:0,y:1}, a:{x:-1,y:0}, d:{x:1,y:0},
      W:{x:0,y:-1}, S:{x:0,y:1}, A:{x:-1,y:0}, D:{x:1,y:0}
    };
    if(map[e.key] || map[e.code]){
      const dir = map[e.key]||map[e.code];
      // prevent reversing directly
      if(dir.x === -state.dir.x && dir.y === -state.dir.y) return;
      state.nextDir = dir;
    }
  });

  // Start / pause / UI
  UI.btnNew.addEventListener('click', ()=>{ showNewGameModal(); });
  UI.btnHistory.addEventListener('click', ()=>{ showHistoryModal(); });
  UI.btnSettings.addEventListener('click', ()=>{ showSettingsModal(); });
  UI.btnStart.addEventListener('click', ()=>{ startCountdownAndRun(); });
  UI.btnQuick.addEventListener('click', ()=>{ startGame(); });
  UI.btnLoadSounds.addEventListener('click', ()=>{ 
    const ok = loadSounds();
    alert(ok? 'Sounds loaded (eat.wav & game_over.wav).' : 'Could not load sounds. Make sure files exist.');
  });

  function togglePause(){
    state.paused = !state.paused;
    if(state.paused) showPauseMenu();
    else closeModal();
  }
  function pauseGame(){
    state.paused = true;
    showPauseMenu();
  }

  function startCountdownAndRun(){
    const c = 3;
    showModal(`<div style="text-align:center"><div class="countdown" id="countdown">${c}</div><div class="muted" style="margin-top:8px">Get ready...</div></div>`);
    let n = c;
    const iv = setInterval(()=>{
      n--;
      const el = document.getElementById('countdown');
      if(el) el.textContent = n>0? n : 'Go';
      if(n < 0){
        clearInterval(iv);
        closeModal();
        startGame();
      }
    }, 700);
  }

  function startGame(){
    // validate profile
    const name = UI.name.value.trim() || 'Player';
    const age = parseInt(UI.age.value,10) || 0;
    const kids = UI.chkKids.checked || age < 18;
    state.loopMode = (UI.variant.value === 'loop');
    UI.mode.textContent = state.loopMode ? 'Loop' : 'Box';
    state.fps = parseInt(UI.speedRange.value,10) || 8;
    // Kids mode rules
    if(kids && state.roundCount >= 3){
      showHistoryModal();
      return;
    }
    // ready
    resetGame();
    state.running = true;
    state.paused = false;
    // if profile age under 18 mark kids mode
    state.kidsMode = kids;
    closeModal();
    // if sound not loaded and sound checkbox on, try to load
    if(UI.chkSound.checked && !SND.loaded) loadSounds();
  }

  function endGame(){
    state.running = false;
    // play sound
    if(UI.chkSound.checked && SND.loaded && SND.gameOver){
      try{ SND.gameOver.play(); }catch(e){}
    }
    // save score to profile
    const name = UI.name.value.trim() || 'Player';
    const age = parseInt(UI.age.value,10) || 0;
    addScoreToProfile(name, age, state.score);
    state.roundCount++;
    // kids mode check
    if(state.kidsMode && state.roundCount >= 3){
      showModal(`<div class="modal"><h3>Kids Mode Complete</h3><div class="muted">You've played 3 rounds. Check your history to see scores.</div><div style="margin-top:12px;display:flex;gap:8px"><button class="btn primary" id="btnHistoryModal">View History</button><button class="btn" id="btnCloseModal">Close</button></div></div>`);
      document.getElementById('btnHistoryModal').addEventListener('click', ()=>{ closeModal(); showHistoryModal(); });
      document.getElementById('btnCloseModal').addEventListener('click', ()=>{ closeModal(); });
    } else {
      showModal(`<div class="modal"><h3>Game Over</h3><div class="muted">Score: ${state.score}</div><div style="margin-top:12px;display:flex;gap:8px"><button class="btn primary" id="btnRestart">Restart</button><button class="btn" id="btnClose">Close</button></div></div>`);
      document.getElementById('btnRestart').addEventListener('click', ()=>{ closeModal(); startGame(); });
      document.getElementById('btnClose').addEventListener('click', ()=>{ closeModal(); });
    }
  }

  // Modal helpers
  function showModal(html){
    const root = document.getElementById('modalRoot');
    root.style.display = 'flex';
    root.innerHTML = `<div class="overlay"><div class="modal">${html}</div></div>`;
    // allow ESC to close
    root.querySelector('.overlay').addEventListener('click', (e)=>{ if(e.target === e.currentTarget) closeModal(); });
  }
  function closeModal(){ const root = document.getElementById('modalRoot'); root.style.display='none'; root.innerHTML=''; }

  function showPauseMenu(){
    showModal(`<div style="display:flex;flex-direction:column;gap:10px"><h3>Paused</h3><div class="muted">Press P to resume</div><div style="display:flex;gap:8px;margin-top:8px"><button class="btn primary" id="resume">Resume</button><button class="btn" id="restart">New Game</button><button class="btn" id="quit">Quit</button></div></div>`);
    document.getElementById('resume').addEventListener('click', ()=>{ state.paused=false; closeModal(); });
    document.getElementById('restart').addEventListener('click', ()=>{ closeModal(); startGame(); });
    document.getElementById('quit').addEventListener('click', ()=>{ closeModal(); state.running=false; resetGame(); });
  }

  function showNewGameModal(){
    showModal(`<div><h3>New Game</h3><div class="muted">Enter details and choose variant.</div><div style="margin-top:10px;display:flex;gap:8px"><button class="btn primary" id="startNow">Start</button><button class="btn" id="closeModal">Cancel</button></div></div>`);
    document.getElementById('startNow').addEventListener('click', ()=>{ closeModal(); startCountdownAndRun(); });
    document.getElementById('closeModal').addEventListener('click', ()=>{ closeModal(); });
  }

  function showSettingsModal(){
    showModal(`<div><h3>Settings</h3><div class="muted">Adjust speed and options.</div><div style="margin-top:10px;display:flex;gap:8px"><button class="btn" id="closeSet">Close</button></div></div>`);
    document.getElementById('closeSet').addEventListener('click', ()=>{ closeModal(); });
  }

  function showHistoryModal(){
    const profiles = loadProfiles();
    let html = `<h3>Player History</h3><div class="muted">Saved profiles and scores</div><div style="margin-top:10px">`;
    const ids = Object.keys(profiles);
    if(ids.length === 0) html += `<div class="muted" style="margin-top:8px">No history yet — play a round to save scores.</div>`;
    ids.forEach(id=>{
      const p = profiles[id];
      html += `<div style="margin-top:10px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)"><strong>${p.name} (age ${p.age})</strong><div class="muted">Scores: ${p.scores.map(s=>s.score).join(', ')}</div></div>`;
    });
    html += `</div><div style="margin-top:12px;display:flex;gap:8px"><button class="btn primary" id="closeH">Close</button><button class="btn" id="clearH">Clear All</button></div>`;
    showModal(html);
    document.getElementById('closeH').addEventListener('click', ()=>{ closeModal(); });
    document.getElementById('clearH').addEventListener('click', ()=>{ if(confirm('Clear all saved history?')){ localStorage.removeItem(STORAGE_KEY); closeModal(); }});
  }

  // Main game loop
  let lastTick = 0;
  function loop(ts){
    if(!state.running){ draw(); requestAnimationFrame(loop); return; }
    if(state.paused){ draw(); requestAnimationFrame(loop); return; }

    const interval = 1000 / state.fps;
    if(ts - lastTick > interval){
      lastTick = ts;
      // update
      updateGame();
    }
    draw();
    requestAnimationFrame(loop);
  }

  function updateGame(){
    // direction applied
    state.dir = state.nextDir;
    const head = {x: state.snake[0].x + state.dir.x, y: state.snake[0].y + state.dir.y};

    if(state.loopMode){
      head.x = (head.x + GRID_W) % GRID_W;
      head.y = (head.y + GRID_H) % GRID_H;
    } else {
      if(head.x < 0 || head.x >= GRID_W || head.y < 0 || head.y >= GRID_H){
        // hit wall
        state.running = false;
        if(UI.chkSound.checked && SND.loaded && SND.gameOver) try{ SND.gameOver.play(); }catch(e){}
        endGame();
        return;
      }
    }

    // collision with self
    if(state.snake.some((p,i)=> i>0 && p.x===head.x && p.y===head.y)){
      state.running = false;
      if(UI.chkSound.checked && SND.loaded && SND.gameOver) try{ SND.gameOver.play(); }catch(e){}
      endGame();
      return;
    }

    // move
    state.snake.unshift(head);

    // check apple
    if(state.apple && head.x === state.apple.x && head.y === state.apple.y){
      state.score++;
      UI.score.textContent = state.score;
      // increase speed slightly
      state.fps = Math.min(28, state.fps + 0.6);
      // play eat sound
      if(UI.chkSound.checked && SND.loaded && SND.eat) try{ SND.eat.play(); }catch(e){}
      // start digestion pulse: will travel along snake indices
      state.digestQueue.push(0);
      state.apple = pickRandomEmpty(state.snake);
    } else {
      state.snake.pop();
    }

    // update digestion queue: increment each index; keep only those < snake length
    state.digestQueue = state.digestQueue.map(v=>v+1).filter(v=> v < state.snake.length);
  }

  // Draw function (ultra-dark, crisp squares)
  function draw(){
    // fill background
    ctx.fillStyle = '#060606';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // grid subtle
    ctx.strokeStyle = 'rgba(255,255,255,0.02)';
    ctx.lineWidth = 1;
    for(let x=0;x<=GRID_W;x++){
      const px = x*CELL;
      ctx.beginPath(); ctx.moveTo(px,0); ctx.lineTo(px,canvas.height); ctx.stroke();
    }
    for(let y=0;y<=GRID_H;y++){
      const py = y*CELL;
      ctx.beginPath(); ctx.moveTo(0,py); ctx.lineTo(canvas.width,py); ctx.stroke();
    }

    // apple
    if(state.apple){
      ctx.fillStyle = '#ff2b2b'; // bright red
      ctx.fillRect(state.apple.x*CELL+2, state.apple.y*CELL+2, CELL-4, CELL-4);
      // small shine
      ctx.fillStyle = 'rgba(255,255,255,0.07)';
      ctx.fillRect(state.apple.x*CELL + 4, state.apple.y*CELL + 4, CELL/3, CELL/3);
    }

    // snake
    for(let i=0;i<state.snake.length;i++){
      const p = state.snake[i];
      // default color
      let color = `rgb(${SNAKE_COLOR[0]},${SNAKE_COLOR[1]},${SNAKE_COLOR[2]})`;
      // digest pulse: if digestQueue contains index equal to some value -> compute highlight
      if(state.digestQueue.includes(i)){
        // compute brightened color
        const bright = SNAKE_COLOR.map((c,idx)=> Math.min(255, c + (idx===0?90:60)));
        color = `rgb(${bright[0]},${bright[1]},${bright[2]})`;
      }
      // head accent
      if(i === 0){
        // draw head slightly larger with inset
        ctx.fillStyle = color;
        ctx.fillRect(p.x*CELL+1, p.y*CELL+1, CELL-2, CELL-2);
        // eye (contrasting)
        ctx.fillStyle = 'rgba(0,0,0,0.5)';
        const hx = p.x*CELL + CELL*0.6, hy = p.y*CELL + CELL*0.3;
        ctx.fillRect(hx, hy, 3, 3);
      } else {
        ctx.fillStyle = color;
        ctx.fillRect(p.x*CELL+2, p.y*CELL+2, CELL-4, CELL-4);
      }
    }

    // subtle HUD on canvas
    ctx.fillStyle = 'rgba(255,255,255,0.03)';
    ctx.fillRect(canvas.width-180, 6, 170, 36);
    ctx.fillStyle = 'rgba(255,255,255,0.06)';
    ctx.fillRect(6, canvas.height-46, 220, 36);

    // paused overlay
    if(state.paused){
      ctx.fillStyle = 'rgba(0,0,0,0.55)';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#fff';
      ctx.font = '28px sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('Paused', canvas.width/2, canvas.height/2);
      ctx.textAlign = 'left';
    }
  }

  // start render loop
  requestAnimationFrame(loop);

  // Simple menu: showMainMenu at load
  function showMainMenu(){
    showModal(`<div style="text-align:center"><h2>Ultra-Modern Snake</h2><div class="muted">Choose an option</div><div style="margin-top:12px;display:flex;gap:8px;justify-content:center"><button class="btn primary" id="mStart">New Game</button><button class="btn" id="mHistory">History</button><button class="btn" id="mSettings">Settings</button></div></div>`);
    document.getElementById('mStart').addEventListener('click', ()=>{ closeModal(); showNewGameModal(); });
    document.getElementById('mHistory').addEventListener('click', ()=>{ closeModal(); showHistoryModal(); });
    document.getElementById('mSettings').addEventListener('click', ()=>{ closeModal(); showSettingsModal(); });
  }

  // Show main menu at first load
  showMainMenu();

  // Initialize: try load sounds quietly if the checkbox is on
  if(UI.chkSound.checked) loadSounds();

  // UI interactions: speed slider update
  UI.speedRange.addEventListener('input', ()=>{ /* will apply on next start */ });

  // Quick start binds
  UI.btnQuick.addEventListener('click', ()=>{ startGame(); });

  // ensure canvas fits nicely
  function fitCanvas(){
    const wrap = document.getElementById('boardWrap');
    const w = wrap.clientWidth - 28; // padding
    const h = wrap.clientHeight - 28;
    // preserve aspect ratio used by grid (GRID_W x GRID_H)
    const cell = Math.min(Math.floor(w / GRID_W), Math.floor(h / GRID_H));
    const cw = cell * GRID_W;
    const ch = cell * GRID_H;
    canvas.style.width = cw + 'px';
    canvas.style.height = ch + 'px';
  }
  window.addEventListener('resize', fitCanvas);
  fitCanvas();

})();
</script>
</body>
</html>
